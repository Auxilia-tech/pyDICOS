<!--
Stratovan Corporation Copyright and Disclaimer Notice:
Copyright (c) 2014 Stratovan Corporation. All Rights Reserved.
Permission to use, copy, modify, and distribute this software and its
documentation without a signed licensing agreement, is hereby granted,
provided that this copyright notice, this paragraph and the following two
paragraphs appear in all copies, modifications, and distributions.
IN NO EVENT SHALL STRATOVAN BE LIABLE TO ANY PARTY FOR DIRECT, INDIRECT,
SPECIAL, INCIDENTAL, OR CONSEQUENTIAL DAMAGES, INCLUDING LOST PROFITS,
ARISING OUT OF THE USE OF THIS SOFTWARE AND ITS DOCUMENTATION, EVEN IF
STRATOVAN HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
STRATOVAN SPECIFICALLY DISCLAIMS ANY WARRANTIES, INCLUDING, BUT NOT LIMITED
TO, THE IMPLIED WARRANTIES OF USE AND FITNESS FOR A PARTICULAR PURPOSE. THE
SOFTWARE AND ACCOMPANYING DOCUMENTATION, IF ANY, PROVIDED HEREUNDER IS
PROVIDED "AS IS". STRATOVAN HAS NO OBLIGATION TO PROVIDE MAINTENANCE,
SUPPORT, UPDATES, ENHANCEMENTS, OR MODIFICATIONS UNLESS DIRECTED BY THE
U.S. GOVERNMENT'S TRANSPORTATION SECURITY ADMINISTRATION (TSA).
-->
<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.18"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Stratovan DICOS Toolkit Class Interfaces and Architecture: Custom Memory Manager for Module-Level API Example</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="DICOS.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="DICOS_TOOLKIT_x120.png"/>
     <div id="projectbrief">Stratovan implementation of DICOS v03 specification</div>
   &#160;<span id="projectnumber">Mon Sep 25 2023</span>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.18 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Custom Memory Manager for Module-Level API Example </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="CustomMemoryManagerModuleLevel_sec"></a>
Custom Memory Manager for Module-Level API Example</h1>
<div class="fragment"><div class="line"><span class="comment">//////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment"></span><span class="comment">/// Stratovan Corporation Copyright and Disclaimer Notice:</span></div>
<div class="line"><span class="comment"></span><span class="comment">///</span></div>
<div class="line"><span class="comment"></span><span class="comment">/// Copyright (c) 2019 Stratovan Corporation. All Rights Reserved.</span></div>
<div class="line"><span class="comment"></span><span class="comment">///</span></div>
<div class="line"><span class="comment"></span><span class="comment">/// Permission to use, copy, modify, and distribute this software and its</span></div>
<div class="line"><span class="comment"></span><span class="comment">/// documentation without a signed licensing agreement, is hereby granted,</span></div>
<div class="line"><span class="comment"></span><span class="comment">/// provided that this copyright notice, this paragraph and the following two</span></div>
<div class="line"><span class="comment"></span><span class="comment">/// paragraphs appear in all copies, modifications, and distributions.</span></div>
<div class="line"><span class="comment"></span><span class="comment">///</span></div>
<div class="line"><span class="comment"></span><span class="comment">/// IN NO EVENT SHALL STRATOVAN BE LIABLE TO ANY PARTY FOR DIRECT, INDIRECT,</span></div>
<div class="line"><span class="comment"></span><span class="comment">/// SPECIAL, INCIDENTAL, OR CONSEQUENTIAL DAMAGES, INCLUDING LOST PROFITS,</span></div>
<div class="line"><span class="comment"></span><span class="comment">/// ARISING OUT OF THE USE OF THIS SOFTWARE AND ITS DOCUMENTATION, EVEN IF</span></div>
<div class="line"><span class="comment"></span><span class="comment">/// STRATOVAN HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span></div>
<div class="line"><span class="comment"></span><span class="comment">///</span></div>
<div class="line"><span class="comment"></span><span class="comment">/// STRATOVAN SPECIFICALLY DISCLAIMS ANY WARRANTIES, INCLUDING, BUT NOT LIMITED</span></div>
<div class="line"><span class="comment"></span><span class="comment">/// TO, THE IMPLIED WARRANTIES OF USE AND FITNESS FOR A PARTICULAR PURPOSE. THE</span></div>
<div class="line"><span class="comment"></span><span class="comment">/// SOFTWARE AND ACCOMPANYING DOCUMENTATION, IF ANY, PROVIDED HEREUNDER IS</span></div>
<div class="line"><span class="comment"></span><span class="comment">/// PROVIDED &quot;AS IS&quot;. STRATOVAN HAS NO OBLIGATION TO PROVIDE MAINTENANCE,</span></div>
<div class="line"><span class="comment"></span><span class="comment">/// SUPPORT, UPDATES, ENHANCEMENTS, OR MODIFICATIONS UNLESS DIRECTED BY THE</span></div>
<div class="line"><span class="comment"></span><span class="comment">/// U.S. GOVERNMENT&#39;S TRANSPORTATION SECURITY ADMINISTRATION (TSA).</span></div>
<div class="line"><span class="comment"></span><span class="comment">///</span></div>
<div class="line"><span class="comment"></span><span class="comment">//////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment"></span><span class="comment">// StartModuleLevelWithCustomMemoryManager</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// This example shows how to use IMemoryManager to provide memory allocation and </span></div>
<div class="line"><span class="comment">// deallocation for the DICOS library&#39;s when loading with Module-Level API.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="_d_i_c_o_s_8h.html">SDICOS/DICOS.h</a>&quot;</span> <span class="comment">//Header for DICOS</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;map&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// This class derives from the IMemoryManager interface class and will handle allocating and </span></div>
<div class="line"><span class="comment">// deallocating memory for the DICOS library.</span></div>
<div class="line"><span class="comment">// This class preallocates a fixed number of buffers which are passed to the DICOS library for</span></div>
<div class="line"><span class="comment">// its pixel data.</span></div>
<div class="line"><span class="comment">// When the DICOS library needs to delete the allocated data, this class&#39;s deallocation function</span></div>
<div class="line"><span class="comment">// is called with the buffer passed as a parameter allowing it to be recycled without actually deleting it.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="keyword">class </span>CustomMemoryManager : <span class="keyword">public</span> <a class="code" href="class_s_d_i_c_o_s_1_1_i_memory_manager.html">SDICOS::IMemoryManager</a></div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <a class="code" href="class_s_d_i_c_o_s_1_1_array1_d.html">SDICOS::Array1D&lt; std::pair&lt;bool, SDICOS::MemoryBuffer&gt;</a> &gt;    m_vBuffers; <span class="comment">//Array of preallocated buffers</span></div>
<div class="line">    std::map&lt;const unsigned char*, SDICOS::S_UINT32&gt;            m_mapUsedBuffers; <span class="comment">//Simple tracking for which slices are used</span></div>
<div class="line">    <span class="keyword">const</span> SDICOS::S_UINT64                                      m_nBufferSizeInBytes; <span class="comment">//Size of each buffer</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">//Constructor preallocates the buffers</span></div>
<div class="line">    CustomMemoryManager(<span class="keyword">const</span> SDICOS::S_UINT64 m_nBufferSizeInBytes = (512 * 512 * 8), <span class="keyword">const</span> SDICOS::S_UINT32 nNumBuffersToAllocated = 500);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//Override from IMemoryManager to use preallocated buffer. This function will provide a buffer </span></div>
<div class="line">    <span class="comment">//to the DICOS library and mark that buffer as &#39;used&#39;.</span></div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="class_s_d_i_c_o_s_1_1_i_memory_manager.html#a150586142cb68f372bd400719292ee9f">OnAllocate</a>(<a class="code" href="class_s_d_i_c_o_s_1_1_memory_buffer.html">SDICOS::MemoryBuffer</a> &amp;mbAllocate, <span class="keyword">const</span> SDICOS::S_UINT64 nSizeInBytesToAllocate);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//Override from IMemoryManager to deallocated buffer. This function removes the buffer from the &#39;used&#39; list</span></div>
<div class="line">    <span class="comment">//and allows it to be used again in OnAllocate()</span></div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="class_s_d_i_c_o_s_1_1_i_memory_manager.html#ac5891c6d6870cb8274becd0bf9fce320">OnDeallocate</a>(<a class="code" href="class_s_d_i_c_o_s_1_1_memory_buffer.html">SDICOS::MemoryBuffer</a> &amp;mbDeallocate);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//Override from IMemoryManager to set the memory policy for the buffer passed to the DICOS library.</span></div>
<div class="line">    <span class="comment">//Since this class owns the data and the DICOS library is borrowing it, this function will be set</span></div>
<div class="line">    <span class="comment">//to return MemoryBuffer::enumPolicy_DoesNotOwnData</span></div>
<div class="line">    <span class="keyword">virtual</span> <a class="code" href="class_s_d_i_c_o_s_1_1_memory_buffer.html#afc4a60507881124d1db196cc50c2150e">SDICOS::MemoryBuffer::MEMORY_POLICY</a> <a class="code" href="class_s_d_i_c_o_s_1_1_i_memory_manager.html#a2ce6947515124f40a41f94c9c5a860c9">OnGetSliceMemoryPolicy</a>()<span class="keyword">const</span>;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="_client_2_c-_echo_2main_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>()</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">const</span> SDICOS::S_UINT64  nSizeOfBuffer(512 * 512 * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));   <span class="comment">//Support float volume slices of size 512 x 512</span></div>
<div class="line">    <span class="keyword">const</span> SDICOS::S_UINT32  nNumberOfBuffers(500);  <span class="comment">//Total number of slices to support</span></div>
<div class="line">    CustomMemoryManager     customMemoryManager(nSizeOfBuffer, nNumberOfBuffers);   <span class="comment">//Memory manager for loading DICOS data</span></div>
<div class="line">    <span class="keywordtype">bool</span> bRes = <span class="keyword">true</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//AIT 2D</span></div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="class_s_d_i_c_o_s_1_1_a_i_t2_d_module.html">SDICOS::AIT2DModule</a> ait;    <span class="comment">//Modality to load</span></div>
<div class="line">        <a class="code" href="class_s_d_i_c_o_s_1_1_filename.html">SDICOS::Filename</a> filename(<span class="stringliteral">&quot;../DataFiles/V03_Data/AIT2DwithTDR/ait2d.dcs&quot;</span>); <span class="comment">//Set this to a valid AIT2D file</span></div>
<div class="line">        <a class="code" href="class_s_d_i_c_o_s_1_1_error_log.html">SDICOS::ErrorLog</a> errorlog; <span class="comment">//Error log for loading data</span></div>
<div class="line"> </div>
<div class="line">        <span class="comment">//Call the read function with the added IMemoryManager parameter</span></div>
<div class="line">        <span class="keywordflow">if</span> (ait.<a class="code" href="class_s_d_i_c_o_s_1_1_a_i_t2_d_module.html#a1a167de4046147a4099e05fb717b304e">Read</a>(filename, errorlog, &amp;customMemoryManager))</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;Loaded AIT 2D&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;Failed to load AIT 2D&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">            <span class="keywordflow">if</span>(!<a class="code" href="namespace_s_d_i_c_o_s.html#a8ada1ec0e722ff3865124fbc77e6bbae">SDICOS::FileExists</a>(filename))</div>
<div class="line">                std::cout &lt;&lt; <span class="stringliteral">&quot;File &quot;</span> &lt;&lt; filename &lt;&lt; <span class="stringliteral">&quot; does not exist.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">            std::cout &lt;&lt; errorlog &lt;&lt; std::endl;</div>
<div class="line">            bRes = <span class="keyword">false</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//AIT 3D</span></div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="class_s_d_i_c_o_s_1_1_a_i_t3_d_module.html">SDICOS::AIT3DModule</a> ait;    <span class="comment">//Modality to load</span></div>
<div class="line">        <a class="code" href="class_s_d_i_c_o_s_1_1_filename.html">SDICOS::Filename</a> filename(<span class="stringliteral">&quot;../DataFiles/V03_Data/AIT3D_RHS/ait3d_RHS.dcs&quot;</span>); <span class="comment">//Set this to a valid AIT3D file</span></div>
<div class="line">        <a class="code" href="class_s_d_i_c_o_s_1_1_error_log.html">SDICOS::ErrorLog</a> errorlog; <span class="comment">//Error log for loading data</span></div>
<div class="line"> </div>
<div class="line">        <span class="comment">//Call the read function with the added IMemoryManager parameter</span></div>
<div class="line">        <span class="keywordflow">if</span> (ait.<a class="code" href="class_s_d_i_c_o_s_1_1_a_i_t3_d_module.html#a74d23d24c652b8d53834331cdb152b2d">Read</a>(filename, errorlog, &amp;customMemoryManager))</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;Loaded AIT 3D&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;Failed to load AIT 3D&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">            <span class="keywordflow">if</span>(!<a class="code" href="namespace_s_d_i_c_o_s.html#a8ada1ec0e722ff3865124fbc77e6bbae">SDICOS::FileExists</a>(filename))</div>
<div class="line">                std::cout &lt;&lt; <span class="stringliteral">&quot;File &quot;</span> &lt;&lt; filename &lt;&lt; <span class="stringliteral">&quot; does not exist.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">            std::cout &lt;&lt; errorlog &lt;&lt; std::endl;</div>
<div class="line">            bRes = <span class="keyword">false</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//CT</span></div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="class_s_d_i_c_o_s_1_1_c_t_module.html">SDICOS::CTModule</a> ct;    <span class="comment">//Modality to load</span></div>
<div class="line">        <a class="code" href="class_s_d_i_c_o_s_1_1_filename.html">SDICOS::Filename</a> filename(<span class="stringliteral">&quot;../DataFiles/V03_Data/CT/CTUserAPI.dcs&quot;</span>); <span class="comment">//Set this to a valid CT file</span></div>
<div class="line">        <a class="code" href="class_s_d_i_c_o_s_1_1_error_log.html">SDICOS::ErrorLog</a> errorlog; <span class="comment">//Error log for loading data</span></div>
<div class="line"> </div>
<div class="line">         <span class="comment">//Call the read function with the added IMemoryManager parameter</span></div>
<div class="line">        <span class="keywordflow">if</span> (ct.<a class="code" href="class_s_d_i_c_o_s_1_1_c_t_module.html#a7f37dfc311fe5bea03f8c8cd4f8ef617">Read</a>(filename, errorlog, &amp;customMemoryManager))</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;Loaded CT&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;Failed to load CT&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">            <span class="keywordflow">if</span>(!<a class="code" href="namespace_s_d_i_c_o_s.html#a8ada1ec0e722ff3865124fbc77e6bbae">SDICOS::FileExists</a>(filename))</div>
<div class="line">                std::cout &lt;&lt; <span class="stringliteral">&quot;File &quot;</span> &lt;&lt; filename &lt;&lt; <span class="stringliteral">&quot; does not exist.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">            std::cout &lt;&lt; errorlog &lt;&lt; std::endl;</div>
<div class="line">            bRes = <span class="keyword">false</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//DX</span></div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="class_s_d_i_c_o_s_1_1_d_x_module.html">SDICOS::DXModule</a> dx;    <span class="comment">//Modality to load</span></div>
<div class="line">        <a class="code" href="class_s_d_i_c_o_s_1_1_filename.html">SDICOS::Filename</a> filename(<span class="stringliteral">&quot;../DataFiles/V03_Data/DXwithTDR/dx.dcs&quot;</span>); <span class="comment">//Set this to a valid DX file</span></div>
<div class="line">        <a class="code" href="class_s_d_i_c_o_s_1_1_error_log.html">SDICOS::ErrorLog</a> errorlog; <span class="comment">//Error log for loading data</span></div>
<div class="line"> </div>
<div class="line">        <span class="comment">//Call the read function with the added IMemoryManager parameter</span></div>
<div class="line">        <span class="keywordflow">if</span> (dx.<a class="code" href="class_s_d_i_c_o_s_1_1_d_x_module.html#a263cd7e09b132216f381567650e1dee9">Read</a>(filename, errorlog, &amp;customMemoryManager))</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;Loaded DX&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;Failed to load DX&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">            <span class="keywordflow">if</span>(!<a class="code" href="namespace_s_d_i_c_o_s.html#a8ada1ec0e722ff3865124fbc77e6bbae">SDICOS::FileExists</a>(filename))</div>
<div class="line">                std::cout &lt;&lt; <span class="stringliteral">&quot;File &quot;</span> &lt;&lt; filename &lt;&lt; <span class="stringliteral">&quot; does not exist.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">            std::cout &lt;&lt; errorlog &lt;&lt; std::endl;</div>
<div class="line">            bRes = <span class="keyword">false</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> bRes ? 0 : 1;</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line">CustomMemoryManager::CustomMemoryManager(<span class="keyword">const</span> SDICOS::S_UINT64 m_nBufferSizeInBytes, <span class="keyword">const</span> SDICOS::S_UINT32 nNumBuffersToAllocated)</div>
<div class="line">    : m_nBufferSizeInBytes(m_nBufferSizeInBytes)</div>
<div class="line">{</div>
<div class="line">    m_vBuffers.<a class="code" href="class_s_d_i_c_o_s_1_1_array1_d.html#a1e0b1d1e4d0da3cc0f87bb70cd3d8928">SetSize</a>(nNumBuffersToAllocated); <span class="comment">//Allocate a set number of buffers</span></div>
<div class="line"> </div>
<div class="line">    std::pair&lt;bool, SDICOS::MemoryBuffer&gt; *pBuffer(m_vBuffers.<a class="code" href="class_s_d_i_c_o_s_1_1_array1_d.html#a9014e01edd68fd0d5c611364aa51200d">GetBuffer</a>());</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//Initialize each buffer to the indicated size and mark them as available</span></div>
<div class="line">    <span class="keywordflow">for</span> (SDICOS::S_UINT32 n(0); n &lt; nNumBuffersToAllocated; ++n, ++pBuffer)</div>
<div class="line">    {</div>
<div class="line">        pBuffer-&gt;first = <span class="keyword">true</span>;</div>
<div class="line">        pBuffer-&gt;second.GrowTo(m_nBufferSizeInBytes);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">bool</span> <a class="code" href="class_s_d_i_c_o_s_1_1_i_memory_manager.html#a150586142cb68f372bd400719292ee9f">CustomMemoryManager::OnAllocate</a>(<a class="code" href="class_s_d_i_c_o_s_1_1_memory_buffer.html">SDICOS::MemoryBuffer</a> &amp;mbAllocate, <span class="keyword">const</span> SDICOS::S_UINT64 nSizeInBytesToAllocate)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">//Check if the requested buffer size is too large. This will tell the DICOS library to</span></div>
<div class="line">    <span class="comment">//allocate a buffer itself.</span></div>
<div class="line">    <span class="keywordflow">if</span> (m_nBufferSizeInBytes &lt;= nSizeInBytesToAllocate)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//Find an available buffer</span></div>
<div class="line">    std::pair&lt;bool, SDICOS::MemoryBuffer&gt; *pBuffer(m_vBuffers.<a class="code" href="class_s_d_i_c_o_s_1_1_array1_d.html#a9014e01edd68fd0d5c611364aa51200d">GetBuffer</a>());</div>
<div class="line">    <span class="keywordflow">for</span> (SDICOS::S_UINT32 n(0); n &lt; m_vBuffers.<a class="code" href="class_s_d_i_c_o_s_1_1_array1_d.html#afcf7a4636f656ebfc0771b684a8baec6">GetSize</a>(); ++n, ++pBuffer)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (pBuffer-&gt;first)</div>
<div class="line">        {</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;Allocated slice &quot;</span> &lt;&lt; n &lt;&lt; std::endl; <span class="comment">//Print out the index of the buffer</span></div>
<div class="line"> </div>
<div class="line">            <span class="comment">//Even though the buffer allocated may be larger, only state the requested size</span></div>
<div class="line">            <span class="comment">//has been provided.</span></div>
<div class="line">            pBuffer-&gt;first = <span class="keyword">false</span>; <span class="comment">//Indicate buffer is no longer available</span></div>
<div class="line">            mbAllocate.<a class="code" href="class_s_d_i_c_o_s_1_1_memory_buffer.html#a6d21e6f218a2fbcac2cf0f8dbbba8062">SetBuffer</a>(pBuffer-&gt;second.GetData(), nSizeInBytesToAllocate);</div>
<div class="line">            m_mapUsedBuffers[pBuffer-&gt;second.GetData()] = n;    <span class="comment">//Track the used memory buffer</span></div>
<div class="line"> </div>
<div class="line">            <span class="comment">//Return true to tell the DICOS library this class provided a buffer of the requested size</span></div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//No more buffers available, return false so the DICOS library handls allocation</span></div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">bool</span> CustomMemoryManager::OnDeallocate(<a class="code" href="class_s_d_i_c_o_s_1_1_memory_buffer.html">SDICOS::MemoryBuffer</a> &amp;mbDeallocate)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">//If memory policy does match, then the buffer was not allocated by this class</span></div>
<div class="line">    <span class="keywordflow">if</span> (GetSliceMemoryPolicy() != mbDeallocate.<a class="code" href="class_s_d_i_c_o_s_1_1_memory_buffer.html#a445fad751ce974d9c0deac75c9382b50">GetMemoryPolicy</a>())</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">//Returning false allows the DICOS library to delete the buffer based on its memory policy</span></div>
<div class="line"> </div>
<div class="line">    std::map&lt;const unsigned char*, SDICOS::S_UINT32&gt;::iterator it;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//Check if the buffer was provided by this class</span></div>
<div class="line">    it = m_mapUsedBuffers.find(mbDeallocate.<a class="code" href="class_s_d_i_c_o_s_1_1_memory_buffer.html#a88cb4b0a0df003a14e044e5c208466cf">GetData</a>());</div>
<div class="line">    <span class="keywordflow">if</span> (m_mapUsedBuffers.end() == it)</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">//Returning false allows the DICOS library to delete the buffer based on its memory policy</span></div>
<div class="line"> </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Deallocated slice &quot;</span> &lt;&lt; it-&gt;second &lt;&lt; std::endl; <span class="comment">//Print out the index of the buffer</span></div>
<div class="line"> </div>
<div class="line">    m_vBuffers[it-&gt;second].first = <span class="keyword">true</span>; <span class="comment">//Mark the buffer as available for use in OnAllocate()</span></div>
<div class="line">    m_mapUsedBuffers.erase(it); <span class="comment">//Remove buffer from the &#39;used&#39; list</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">//Returning true tells the DICOS library this class has deallocated the buffer</span></div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code" href="class_s_d_i_c_o_s_1_1_memory_buffer.html#afc4a60507881124d1db196cc50c2150e">SDICOS::MemoryBuffer::MEMORY_POLICY</a> CustomMemoryManager::OnGetSliceMemoryPolicy()<span class="keyword">const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    <span class="comment">//Tell the DICOS library it does not own the data. This prevents the DICOS library</span></div>
<div class="line">    <span class="comment">//from deleting the preallocated buffers.</span></div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="class_s_d_i_c_o_s_1_1_memory_buffer.html#afc4a60507881124d1db196cc50c2150eaf4d906d35f3f9a3ed6c41c911fac0c5b">SDICOS::MemoryBuffer::enumPolicy_DoesNotOwnData</a>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// EndModuleLevelWithCustomMemoryManager</span></div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="comment">// StartModuleLevelWithCustomMemoryManager</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// This example shows how to use IMemoryManager to provide memory allocation and </span></div>
<div class="line"><span class="comment">// deallocation for the DICOS library&#39;s when loading with Module-Level API.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="_d_i_c_o_s_8h.html">SDICOS/DICOS.h</a>&quot;</span> <span class="comment">//Header for DICOS</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;map&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// This class derives from the IMemoryManager interface class and will handle allocating and </span></div>
<div class="line"><span class="comment">// deallocating memory for the DICOS library.</span></div>
<div class="line"><span class="comment">// This class preallocates a fixed number of buffers which are passed to the DICOS library for</span></div>
<div class="line"><span class="comment">// its pixel data.</span></div>
<div class="line"><span class="comment">// When the DICOS library needs to delete the allocated data, this class&#39;s deallocation function</span></div>
<div class="line"><span class="comment">// is called with the buffer passed as a parameter allowing it to be recycled without actually deleting it.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="keyword">class </span>CustomMemoryManager : <span class="keyword">public</span> <a class="code" href="class_s_d_i_c_o_s_1_1_i_memory_manager.html">SDICOS::IMemoryManager</a></div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <a class="code" href="class_s_d_i_c_o_s_1_1_array1_d.html">SDICOS::Array1D&lt; std::pair&lt;bool, SDICOS::MemoryBuffer&gt;</a> &gt;    m_vBuffers; <span class="comment">//Array of preallocated buffers</span></div>
<div class="line">    std::map&lt;const unsigned char*, SDICOS::S_UINT32&gt;            m_mapUsedBuffers; <span class="comment">//Simple tracking for which slices are used</span></div>
<div class="line">    <span class="keyword">const</span> SDICOS::S_UINT64                                      m_nBufferSizeInBytes; <span class="comment">//Size of each buffer</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">//Constructor preallocates the buffers</span></div>
<div class="line">    CustomMemoryManager(<span class="keyword">const</span> SDICOS::S_UINT64 m_nBufferSizeInBytes = (512 * 512 * 8), <span class="keyword">const</span> SDICOS::S_UINT32 nNumBuffersToAllocated = 500);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//Override from IMemoryManager to use preallocated buffer. This function will provide a buffer </span></div>
<div class="line">    <span class="comment">//to the DICOS library and mark that buffer as &#39;used&#39;.</span></div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="class_s_d_i_c_o_s_1_1_i_memory_manager.html#a150586142cb68f372bd400719292ee9f">OnAllocate</a>(<a class="code" href="class_s_d_i_c_o_s_1_1_memory_buffer.html">SDICOS::MemoryBuffer</a> &amp;mbAllocate, <span class="keyword">const</span> SDICOS::S_UINT64 nSizeInBytesToAllocate);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//Override from IMemoryManager to deallocated buffer. This function removes the buffer from the &#39;used&#39; list</span></div>
<div class="line">    <span class="comment">//and allows it to be used again in OnAllocate()</span></div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="class_s_d_i_c_o_s_1_1_i_memory_manager.html#ac5891c6d6870cb8274becd0bf9fce320">OnDeallocate</a>(<a class="code" href="class_s_d_i_c_o_s_1_1_memory_buffer.html">SDICOS::MemoryBuffer</a> &amp;mbDeallocate);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//Override from IMemoryManager to set the memory policy for the buffer passed to the DICOS library.</span></div>
<div class="line">    <span class="comment">//Since this class owns the data and the DICOS library is borrowing it, this function will be set</span></div>
<div class="line">    <span class="comment">//to return MemoryBuffer::enumPolicy_DoesNotOwnData</span></div>
<div class="line">    <span class="keyword">virtual</span> <a class="code" href="class_s_d_i_c_o_s_1_1_memory_buffer.html#afc4a60507881124d1db196cc50c2150e">SDICOS::MemoryBuffer::MEMORY_POLICY</a> <a class="code" href="class_s_d_i_c_o_s_1_1_i_memory_manager.html#a2ce6947515124f40a41f94c9c5a860c9">OnGetSliceMemoryPolicy</a>()<span class="keyword">const</span>;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="_client_2_c-_echo_2main_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>()</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">const</span> SDICOS::S_UINT64  nSizeOfBuffer(512 * 512 * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));   <span class="comment">//Support float volume slices of size 512 x 512</span></div>
<div class="line">    <span class="keyword">const</span> SDICOS::S_UINT32  nNumberOfBuffers(500);  <span class="comment">//Total number of slices to support</span></div>
<div class="line">    CustomMemoryManager     customMemoryManager(nSizeOfBuffer, nNumberOfBuffers);   <span class="comment">//Memory manager for loading DICOS data</span></div>
<div class="line">    <span class="keywordtype">bool</span> bRes = <span class="keyword">true</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//AIT 2D</span></div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="class_s_d_i_c_o_s_1_1_a_i_t2_d_module.html">SDICOS::AIT2DModule</a> ait;    <span class="comment">//Modality to load</span></div>
<div class="line">        <a class="code" href="class_s_d_i_c_o_s_1_1_filename.html">SDICOS::Filename</a> filename(<span class="stringliteral">&quot;../DataFiles/V03_Data/AIT2DwithTDR/ait2d.dcs&quot;</span>); <span class="comment">//Set this to a valid AIT2D file</span></div>
<div class="line">        <a class="code" href="class_s_d_i_c_o_s_1_1_error_log.html">SDICOS::ErrorLog</a> errorlog; <span class="comment">//Error log for loading data</span></div>
<div class="line"> </div>
<div class="line">        <span class="comment">//Call the read function with the added IMemoryManager parameter</span></div>
<div class="line">        <span class="keywordflow">if</span> (ait.<a class="code" href="class_s_d_i_c_o_s_1_1_a_i_t2_d_module.html#a1a167de4046147a4099e05fb717b304e">Read</a>(filename, errorlog, &amp;customMemoryManager))</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;Loaded AIT 2D&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;Failed to load AIT 2D&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">            <span class="keywordflow">if</span>(!<a class="code" href="namespace_s_d_i_c_o_s.html#a8ada1ec0e722ff3865124fbc77e6bbae">SDICOS::FileExists</a>(filename))</div>
<div class="line">                std::cout &lt;&lt; <span class="stringliteral">&quot;File &quot;</span> &lt;&lt; filename &lt;&lt; <span class="stringliteral">&quot; does not exist.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">            std::cout &lt;&lt; errorlog &lt;&lt; std::endl;</div>
<div class="line">            bRes = <span class="keyword">false</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//AIT 3D</span></div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="class_s_d_i_c_o_s_1_1_a_i_t3_d_module.html">SDICOS::AIT3DModule</a> ait;    <span class="comment">//Modality to load</span></div>
<div class="line">        <a class="code" href="class_s_d_i_c_o_s_1_1_filename.html">SDICOS::Filename</a> filename(<span class="stringliteral">&quot;../DataFiles/V03_Data/AIT3D_RHS/ait3d_RHS.dcs&quot;</span>); <span class="comment">//Set this to a valid AIT3D file</span></div>
<div class="line">        <a class="code" href="class_s_d_i_c_o_s_1_1_error_log.html">SDICOS::ErrorLog</a> errorlog; <span class="comment">//Error log for loading data</span></div>
<div class="line"> </div>
<div class="line">        <span class="comment">//Call the read function with the added IMemoryManager parameter</span></div>
<div class="line">        <span class="keywordflow">if</span> (ait.<a class="code" href="class_s_d_i_c_o_s_1_1_a_i_t3_d_module.html#a74d23d24c652b8d53834331cdb152b2d">Read</a>(filename, errorlog, &amp;customMemoryManager))</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;Loaded AIT 3D&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;Failed to load AIT 3D&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">            <span class="keywordflow">if</span>(!<a class="code" href="namespace_s_d_i_c_o_s.html#a8ada1ec0e722ff3865124fbc77e6bbae">SDICOS::FileExists</a>(filename))</div>
<div class="line">                std::cout &lt;&lt; <span class="stringliteral">&quot;File &quot;</span> &lt;&lt; filename &lt;&lt; <span class="stringliteral">&quot; does not exist.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">            std::cout &lt;&lt; errorlog &lt;&lt; std::endl;</div>
<div class="line">            bRes = <span class="keyword">false</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//CT</span></div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="class_s_d_i_c_o_s_1_1_c_t_module.html">SDICOS::CTModule</a> ct;    <span class="comment">//Modality to load</span></div>
<div class="line">        <a class="code" href="class_s_d_i_c_o_s_1_1_filename.html">SDICOS::Filename</a> filename(<span class="stringliteral">&quot;../DataFiles/V03_Data/CT/CTUserAPI.dcs&quot;</span>); <span class="comment">//Set this to a valid CT file</span></div>
<div class="line">        <a class="code" href="class_s_d_i_c_o_s_1_1_error_log.html">SDICOS::ErrorLog</a> errorlog; <span class="comment">//Error log for loading data</span></div>
<div class="line"> </div>
<div class="line">         <span class="comment">//Call the read function with the added IMemoryManager parameter</span></div>
<div class="line">        <span class="keywordflow">if</span> (ct.<a class="code" href="class_s_d_i_c_o_s_1_1_c_t_module.html#a7f37dfc311fe5bea03f8c8cd4f8ef617">Read</a>(filename, errorlog, &amp;customMemoryManager))</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;Loaded CT&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;Failed to load CT&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">            <span class="keywordflow">if</span>(!<a class="code" href="namespace_s_d_i_c_o_s.html#a8ada1ec0e722ff3865124fbc77e6bbae">SDICOS::FileExists</a>(filename))</div>
<div class="line">                std::cout &lt;&lt; <span class="stringliteral">&quot;File &quot;</span> &lt;&lt; filename &lt;&lt; <span class="stringliteral">&quot; does not exist.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">            std::cout &lt;&lt; errorlog &lt;&lt; std::endl;</div>
<div class="line">            bRes = <span class="keyword">false</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//DX</span></div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="class_s_d_i_c_o_s_1_1_d_x_module.html">SDICOS::DXModule</a> dx;    <span class="comment">//Modality to load</span></div>
<div class="line">        <a class="code" href="class_s_d_i_c_o_s_1_1_filename.html">SDICOS::Filename</a> filename(<span class="stringliteral">&quot;../DataFiles/V03_Data/DXwithTDR/dx.dcs&quot;</span>); <span class="comment">//Set this to a valid DX file</span></div>
<div class="line">        <a class="code" href="class_s_d_i_c_o_s_1_1_error_log.html">SDICOS::ErrorLog</a> errorlog; <span class="comment">//Error log for loading data</span></div>
<div class="line"> </div>
<div class="line">        <span class="comment">//Call the read function with the added IMemoryManager parameter</span></div>
<div class="line">        <span class="keywordflow">if</span> (dx.<a class="code" href="class_s_d_i_c_o_s_1_1_d_x_module.html#a263cd7e09b132216f381567650e1dee9">Read</a>(filename, errorlog, &amp;customMemoryManager))</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;Loaded DX&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;Failed to load DX&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">            <span class="keywordflow">if</span>(!<a class="code" href="namespace_s_d_i_c_o_s.html#a8ada1ec0e722ff3865124fbc77e6bbae">SDICOS::FileExists</a>(filename))</div>
<div class="line">                std::cout &lt;&lt; <span class="stringliteral">&quot;File &quot;</span> &lt;&lt; filename &lt;&lt; <span class="stringliteral">&quot; does not exist.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">            std::cout &lt;&lt; errorlog &lt;&lt; std::endl;</div>
<div class="line">            bRes = <span class="keyword">false</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> bRes ? 0 : 1;</div>
<div class="line">}</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line">CustomMemoryManager::CustomMemoryManager(<span class="keyword">const</span> SDICOS::S_UINT64 m_nBufferSizeInBytes, <span class="keyword">const</span> SDICOS::S_UINT32 nNumBuffersToAllocated)</div>
<div class="line">    : m_nBufferSizeInBytes(m_nBufferSizeInBytes)</div>
<div class="line">{</div>
<div class="line">    m_vBuffers.<a class="code" href="class_s_d_i_c_o_s_1_1_array1_d.html#a1e0b1d1e4d0da3cc0f87bb70cd3d8928">SetSize</a>(nNumBuffersToAllocated); <span class="comment">//Allocate a set number of buffers</span></div>
<div class="line"> </div>
<div class="line">    std::pair&lt;bool, SDICOS::MemoryBuffer&gt; *pBuffer(m_vBuffers.<a class="code" href="class_s_d_i_c_o_s_1_1_array1_d.html#a9014e01edd68fd0d5c611364aa51200d">GetBuffer</a>());</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//Initialize each buffer to the indicated size and mark them as available</span></div>
<div class="line">    <span class="keywordflow">for</span> (SDICOS::S_UINT32 n(0); n &lt; nNumBuffersToAllocated; ++n, ++pBuffer)</div>
<div class="line">    {</div>
<div class="line">        pBuffer-&gt;first = <span class="keyword">true</span>;</div>
<div class="line">        pBuffer-&gt;second.GrowTo(m_nBufferSizeInBytes);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">bool</span> <a class="code" href="class_s_d_i_c_o_s_1_1_i_memory_manager.html#a150586142cb68f372bd400719292ee9f">CustomMemoryManager::OnAllocate</a>(<a class="code" href="class_s_d_i_c_o_s_1_1_memory_buffer.html">SDICOS::MemoryBuffer</a> &amp;mbAllocate, <span class="keyword">const</span> SDICOS::S_UINT64 nSizeInBytesToAllocate)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">//Check if the requested buffer size is too large. This will tell the DICOS library to</span></div>
<div class="line">    <span class="comment">//allocate a buffer itself.</span></div>
<div class="line">    <span class="keywordflow">if</span> (m_nBufferSizeInBytes &lt;= nSizeInBytesToAllocate)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//Find an available buffer</span></div>
<div class="line">    std::pair&lt;bool, SDICOS::MemoryBuffer&gt; *pBuffer(m_vBuffers.<a class="code" href="class_s_d_i_c_o_s_1_1_array1_d.html#a9014e01edd68fd0d5c611364aa51200d">GetBuffer</a>());</div>
<div class="line">    <span class="keywordflow">for</span> (SDICOS::S_UINT32 n(0); n &lt; m_vBuffers.<a class="code" href="class_s_d_i_c_o_s_1_1_array1_d.html#afcf7a4636f656ebfc0771b684a8baec6">GetSize</a>(); ++n, ++pBuffer)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (pBuffer-&gt;first)</div>
<div class="line">        {</div>
<div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;Allocated slice &quot;</span> &lt;&lt; n &lt;&lt; std::endl; <span class="comment">//Print out the index of the buffer</span></div>
<div class="line"> </div>
<div class="line">            <span class="comment">//Even though the buffer allocated may be larger, only state the requested size</span></div>
<div class="line">            <span class="comment">//has been provided.</span></div>
<div class="line">            pBuffer-&gt;first = <span class="keyword">false</span>; <span class="comment">//Indicate buffer is no longer available</span></div>
<div class="line">            mbAllocate.<a class="code" href="class_s_d_i_c_o_s_1_1_memory_buffer.html#a6d21e6f218a2fbcac2cf0f8dbbba8062">SetBuffer</a>(pBuffer-&gt;second.GetData(), nSizeInBytesToAllocate);</div>
<div class="line">            m_mapUsedBuffers[pBuffer-&gt;second.GetData()] = n;    <span class="comment">//Track the used memory buffer</span></div>
<div class="line"> </div>
<div class="line">            <span class="comment">//Return true to tell the DICOS library this class provided a buffer of the requested size</span></div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//No more buffers available, return false so the DICOS library handls allocation</span></div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">bool</span> CustomMemoryManager::OnDeallocate(<a class="code" href="class_s_d_i_c_o_s_1_1_memory_buffer.html">SDICOS::MemoryBuffer</a> &amp;mbDeallocate)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">//If memory policy does match, then the buffer was not allocated by this class</span></div>
<div class="line">    <span class="keywordflow">if</span> (GetSliceMemoryPolicy() != mbDeallocate.<a class="code" href="class_s_d_i_c_o_s_1_1_memory_buffer.html#a445fad751ce974d9c0deac75c9382b50">GetMemoryPolicy</a>())</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">//Returning false allows the DICOS library to delete the buffer based on its memory policy</span></div>
<div class="line"> </div>
<div class="line">    std::map&lt;const unsigned char*, SDICOS::S_UINT32&gt;::iterator it;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//Check if the buffer was provided by this class</span></div>
<div class="line">    it = m_mapUsedBuffers.find(mbDeallocate.<a class="code" href="class_s_d_i_c_o_s_1_1_memory_buffer.html#a88cb4b0a0df003a14e044e5c208466cf">GetData</a>());</div>
<div class="line">    <span class="keywordflow">if</span> (m_mapUsedBuffers.end() == it)</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">//Returning false allows the DICOS library to delete the buffer based on its memory policy</span></div>
<div class="line"> </div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Deallocated slice &quot;</span> &lt;&lt; it-&gt;second &lt;&lt; std::endl; <span class="comment">//Print out the index of the buffer</span></div>
<div class="line"> </div>
<div class="line">    m_vBuffers[it-&gt;second].first = <span class="keyword">true</span>; <span class="comment">//Mark the buffer as available for use in OnAllocate()</span></div>
<div class="line">    m_mapUsedBuffers.erase(it); <span class="comment">//Remove buffer from the &#39;used&#39; list</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">//Returning true tells the DICOS library this class has deallocated the buffer</span></div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code" href="class_s_d_i_c_o_s_1_1_memory_buffer.html#afc4a60507881124d1db196cc50c2150e">SDICOS::MemoryBuffer::MEMORY_POLICY</a> CustomMemoryManager::OnGetSliceMemoryPolicy()<span class="keyword">const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">    <span class="comment">//Tell the DICOS library it does not own the data. This prevents the DICOS library</span></div>
<div class="line">    <span class="comment">//from deleting the preallocated buffers.</span></div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="class_s_d_i_c_o_s_1_1_memory_buffer.html#afc4a60507881124d1db196cc50c2150eaf4d906d35f3f9a3ed6c41c911fac0c5b">SDICOS::MemoryBuffer::enumPolicy_DoesNotOwnData</a>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// EndModuleLevelWithCustomMemoryManager</span></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="ttc" id="aclass_s_d_i_c_o_s_1_1_memory_buffer_html_a445fad751ce974d9c0deac75c9382b50"><div class="ttname"><a href="class_s_d_i_c_o_s_1_1_memory_buffer.html#a445fad751ce974d9c0deac75c9382b50">SDICOS::MemoryBuffer::GetMemoryPolicy</a></div><div class="ttdeci">MEMORY_POLICY GetMemoryPolicy() const</div></div>
<div class="ttc" id="aclass_s_d_i_c_o_s_1_1_a_i_t2_d_module_html_a1a167de4046147a4099e05fb717b304e"><div class="ttname"><a href="class_s_d_i_c_o_s_1_1_a_i_t2_d_module.html#a1a167de4046147a4099e05fb717b304e">SDICOS::AIT2DModule::Read</a></div><div class="ttdeci">bool Read(const Filename &amp;filename, ErrorLog &amp;errorlog, IMemoryManager *pMemMgr=S_NULL)</div><div class="ttdoc">Read file.</div></div>
<div class="ttc" id="aclass_s_d_i_c_o_s_1_1_array1_d_html_a1e0b1d1e4d0da3cc0f87bb70cd3d8928"><div class="ttname"><a href="class_s_d_i_c_o_s_1_1_array1_d.html#a1e0b1d1e4d0da3cc0f87bb70cd3d8928">SDICOS::Array1D::SetSize</a></div><div class="ttdeci">bool SetSize(S_UINT32 nSize, const bool bAllocateExtraCapacity=false)</div><div class="ttdef"><b>Definition:</b> <a href="_array1_d_8h_source.html#l00118">Array1D.h:118</a></div></div>
<div class="ttc" id="aclass_s_d_i_c_o_s_1_1_i_memory_manager_html_ac5891c6d6870cb8274becd0bf9fce320"><div class="ttname"><a href="class_s_d_i_c_o_s_1_1_i_memory_manager.html#ac5891c6d6870cb8274becd0bf9fce320">SDICOS::IMemoryManager::OnDeallocate</a></div><div class="ttdeci">virtual bool OnDeallocate(MemoryBuffer &amp;mbDeallocate)=0</div><div class="ttdoc">Derive to provide a method for deallocating the provided memory.</div></div>
<div class="ttc" id="aclass_s_d_i_c_o_s_1_1_a_i_t3_d_module_html_a74d23d24c652b8d53834331cdb152b2d"><div class="ttname"><a href="class_s_d_i_c_o_s_1_1_a_i_t3_d_module.html#a74d23d24c652b8d53834331cdb152b2d">SDICOS::AIT3DModule::Read</a></div><div class="ttdeci">bool Read(const Filename &amp;filename, ErrorLog &amp;errorlog, IMemoryManager *pMemMgr=S_NULL)</div><div class="ttdoc">Read file.</div></div>
<div class="ttc" id="aclass_s_d_i_c_o_s_1_1_a_i_t2_d_module_html"><div class="ttname"><a href="class_s_d_i_c_o_s_1_1_a_i_t2_d_module.html">SDICOS::AIT2DModule</a></div><div class="ttdef"><b>Definition:</b> <a href="_module_a_i_t2_d_8h_source.html#l00063">ModuleAIT2D.h:64</a></div></div>
<div class="ttc" id="aclass_s_d_i_c_o_s_1_1_d_x_module_html_a263cd7e09b132216f381567650e1dee9"><div class="ttname"><a href="class_s_d_i_c_o_s_1_1_d_x_module.html#a263cd7e09b132216f381567650e1dee9">SDICOS::DXModule::Read</a></div><div class="ttdeci">bool Read(const Filename &amp;filename, ErrorLog &amp;errorlog, IMemoryManager *pMemMgr=S_NULL)</div><div class="ttdoc">Read file.</div></div>
<div class="ttc" id="aclass_s_d_i_c_o_s_1_1_memory_buffer_html_a88cb4b0a0df003a14e044e5c208466cf"><div class="ttname"><a href="class_s_d_i_c_o_s_1_1_memory_buffer.html#a88cb4b0a0df003a14e044e5c208466cf">SDICOS::MemoryBuffer::GetData</a></div><div class="ttdeci">unsigned char * GetData()</div><div class="ttdoc">Returns a pointer to the buffer.</div></div>
<div class="ttc" id="aclass_s_d_i_c_o_s_1_1_array1_d_html_a9014e01edd68fd0d5c611364aa51200d"><div class="ttname"><a href="class_s_d_i_c_o_s_1_1_array1_d.html#a9014e01edd68fd0d5c611364aa51200d">SDICOS::Array1D::GetBuffer</a></div><div class="ttdeci">const CType * GetBuffer() const</div><div class="ttdef"><b>Definition:</b> <a href="_array1_d_8h_source.html#l00292">Array1D.h:292</a></div></div>
<div class="ttc" id="aclass_s_d_i_c_o_s_1_1_error_log_html"><div class="ttname"><a href="class_s_d_i_c_o_s_1_1_error_log.html">SDICOS::ErrorLog</a></div><div class="ttdoc">Implements ErrorLog.</div><div class="ttdef"><b>Definition:</b> <a href="_error_log_8h_source.html#l00054">ErrorLog.h:55</a></div></div>
<div class="ttc" id="a_d_i_c_o_s_8h_html"><div class="ttname"><a href="_d_i_c_o_s_8h.html">DICOS.h</a></div></div>
<div class="ttc" id="aclass_s_d_i_c_o_s_1_1_i_memory_manager_html_a2ce6947515124f40a41f94c9c5a860c9"><div class="ttname"><a href="class_s_d_i_c_o_s_1_1_i_memory_manager.html#a2ce6947515124f40a41f94c9c5a860c9">SDICOS::IMemoryManager::OnGetSliceMemoryPolicy</a></div><div class="ttdeci">virtual MemoryBuffer::MEMORY_POLICY OnGetSliceMemoryPolicy() const =0</div><div class="ttdoc">Derive to provide a default memory policy for MemoryBuffer objects passed into Allocate()</div></div>
<div class="ttc" id="a_client_2_c-_echo_2main_8cpp_html_ae66f6b31b5ad750f1fe042a706a4e3d4"><div class="ttname"><a href="_client_2_c-_echo_2main_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a></div><div class="ttdeci">int main()</div><div class="ttdoc">Stratovan Corporation Copyright and Disclaimer Notice:</div><div class="ttdef"><b>Definition:</b> <a href="_client_2_c-_echo_2main_8cpp_source.html#l00030">Client/C-Echo/main.cpp:30</a></div></div>
<div class="ttc" id="anamespace_s_d_i_c_o_s_html_a8ada1ec0e722ff3865124fbc77e6bbae"><div class="ttname"><a href="namespace_s_d_i_c_o_s.html#a8ada1ec0e722ff3865124fbc77e6bbae">SDICOS::FileExists</a></div><div class="ttdeci">bool FileExists(const Filename &amp;filename)</div><div class="ttdoc">Check for file existence.</div></div>
<div class="ttc" id="aclass_s_d_i_c_o_s_1_1_memory_buffer_html"><div class="ttname"><a href="class_s_d_i_c_o_s_1_1_memory_buffer.html">SDICOS::MemoryBuffer</a></div><div class="ttdoc">A grow-only buffer class.</div><div class="ttdef"><b>Definition:</b> <a href="_memory_buffer_8h_source.html#l00036">MemoryBuffer.h:37</a></div></div>
<div class="ttc" id="aclass_s_d_i_c_o_s_1_1_i_memory_manager_html_a150586142cb68f372bd400719292ee9f"><div class="ttname"><a href="class_s_d_i_c_o_s_1_1_i_memory_manager.html#a150586142cb68f372bd400719292ee9f">SDICOS::IMemoryManager::OnAllocate</a></div><div class="ttdeci">virtual bool OnAllocate(MemoryBuffer &amp;mbAllocate, const S_UINT64 nSizeInBytesToAllocate)=0</div><div class="ttdoc">Derive to provide a method for allocating the requested memory Can be used to move data into the buff...</div></div>
<div class="ttc" id="aclass_s_d_i_c_o_s_1_1_filename_html"><div class="ttname"><a href="class_s_d_i_c_o_s_1_1_filename.html">SDICOS::Filename</a></div><div class="ttdef"><b>Definition:</b> <a href="_file_system_8h_source.html#l00118">FileSystem.h:119</a></div></div>
<div class="ttc" id="aclass_s_d_i_c_o_s_1_1_c_t_module_html"><div class="ttname"><a href="class_s_d_i_c_o_s_1_1_c_t_module.html">SDICOS::CTModule</a></div><div class="ttdoc">Implements CT IOD SPECREF V03 Section 7.3, Table 17.</div><div class="ttdef"><b>Definition:</b> <a href="_module_c_t_8h_source.html#l00051">ModuleCT.h:52</a></div></div>
<div class="ttc" id="aclass_s_d_i_c_o_s_1_1_memory_buffer_html_afc4a60507881124d1db196cc50c2150e"><div class="ttname"><a href="class_s_d_i_c_o_s_1_1_memory_buffer.html#afc4a60507881124d1db196cc50c2150e">SDICOS::MemoryBuffer::MEMORY_POLICY</a></div><div class="ttdeci">MEMORY_POLICY</div><div class="ttdoc">Enumerations to define data ownership.</div><div class="ttdef"><b>Definition:</b> <a href="_memory_buffer_8h_source.html#l00041">MemoryBuffer.h:42</a></div></div>
<div class="ttc" id="aclass_s_d_i_c_o_s_1_1_memory_buffer_html_afc4a60507881124d1db196cc50c2150eaf4d906d35f3f9a3ed6c41c911fac0c5b"><div class="ttname"><a href="class_s_d_i_c_o_s_1_1_memory_buffer.html#afc4a60507881124d1db196cc50c2150eaf4d906d35f3f9a3ed6c41c911fac0c5b">SDICOS::MemoryBuffer::enumPolicy_DoesNotOwnData</a></div><div class="ttdeci">@ enumPolicy_DoesNotOwnData</div><div class="ttdoc">MemoryBuffer does not own the data and will not delete it.</div><div class="ttdef"><b>Definition:</b> <a href="_memory_buffer_8h_source.html#l00043">MemoryBuffer.h:43</a></div></div>
<div class="ttc" id="aclass_s_d_i_c_o_s_1_1_array1_d_html"><div class="ttname"><a href="class_s_d_i_c_o_s_1_1_array1_d.html">SDICOS::Array1D</a></div><div class="ttdoc">Allocates memory on a single contiguous block for efficient access.</div><div class="ttdef"><b>Definition:</b> <a href="_array1_d_8h_source.html#l00041">Array1D.h:42</a></div></div>
<div class="ttc" id="aclass_s_d_i_c_o_s_1_1_d_x_module_html"><div class="ttname"><a href="class_s_d_i_c_o_s_1_1_d_x_module.html">SDICOS::DXModule</a></div><div class="ttdoc">Implements DX IOD SPECREF V03 Section 8.2.1, Table 33.</div><div class="ttdef"><b>Definition:</b> <a href="_module_d_x_8h_source.html#l00060">ModuleDX.h:61</a></div></div>
<div class="ttc" id="aclass_s_d_i_c_o_s_1_1_memory_buffer_html_a6d21e6f218a2fbcac2cf0f8dbbba8062"><div class="ttname"><a href="class_s_d_i_c_o_s_1_1_memory_buffer.html#a6d21e6f218a2fbcac2cf0f8dbbba8062">SDICOS::MemoryBuffer::SetBuffer</a></div><div class="ttdeci">void SetBuffer(unsigned char *pBuffer, const S_UINT64 nSize)</div><div class="ttdoc">Replaces the current buffer with the passed in buffer.</div></div>
<div class="ttc" id="aclass_s_d_i_c_o_s_1_1_array1_d_html_afcf7a4636f656ebfc0771b684a8baec6"><div class="ttname"><a href="class_s_d_i_c_o_s_1_1_array1_d.html#afcf7a4636f656ebfc0771b684a8baec6">SDICOS::Array1D::GetSize</a></div><div class="ttdeci">S_UINT32 GetSize() const</div><div class="ttdoc">Get the number of elements that are used.</div><div class="ttdef"><b>Definition:</b> <a href="_array1_d_8h_source.html#l00208">Array1D.h:208</a></div></div>
<div class="ttc" id="aclass_s_d_i_c_o_s_1_1_i_memory_manager_html"><div class="ttname"><a href="class_s_d_i_c_o_s_1_1_i_memory_manager.html">SDICOS::IMemoryManager</a></div><div class="ttdoc">Memory management interface primarily to provide users with allocation and deallocation management us...</div><div class="ttdef"><b>Definition:</b> <a href="_i_memory_manager_8h_source.html#l00035">IMemoryManager.h:36</a></div></div>
<div class="ttc" id="aclass_s_d_i_c_o_s_1_1_c_t_module_html_a7f37dfc311fe5bea03f8c8cd4f8ef617"><div class="ttname"><a href="class_s_d_i_c_o_s_1_1_c_t_module.html#a7f37dfc311fe5bea03f8c8cd4f8ef617">SDICOS::CTModule::Read</a></div><div class="ttdeci">bool Read(const Filename &amp;filename, ErrorLog &amp;errorlog, IMemoryManager *pMemMgr=S_NULL)</div><div class="ttdoc">Read file.</div></div>
<div class="ttc" id="aclass_s_d_i_c_o_s_1_1_a_i_t3_d_module_html"><div class="ttname"><a href="class_s_d_i_c_o_s_1_1_a_i_t3_d_module.html">SDICOS::AIT3DModule</a></div><div class="ttdoc">Implements 3D AIT Image IOD SPECREF V03 Section 9.3.2, Table 45.</div><div class="ttdef"><b>Definition:</b> <a href="_module_a_i_t3_d_8h_source.html#l00052">ModuleAIT3D.h:53</a></div></div>
<!--
Stratovan Corporation Copyright and Disclaimer Notice:
Copyright (c) 2014 Stratovan Corporation. All Rights Reserved.
Permission to use, copy, modify, and distribute this software and its
documentation without a signed licensing agreement, is hereby granted,
provided that this copyright notice, this paragraph and the following two
paragraphs appear in all copies, modifications, and distributions.
IN NO EVENT SHALL STRATOVAN BE LIABLE TO ANY PARTY FOR DIRECT, INDIRECT,
SPECIAL, INCIDENTAL, OR CONSEQUENTIAL DAMAGES, INCLUDING LOST PROFITS,
ARISING OUT OF THE USE OF THIS SOFTWARE AND ITS DOCUMENTATION, EVEN IF
STRATOVAN HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
STRATOVAN SPECIFICALLY DISCLAIMS ANY WARRANTIES, INCLUDING, BUT NOT LIMITED
TO, THE IMPLIED WARRANTIES OF USE AND FITNESS FOR A PARTICULAR PURPOSE. THE
SOFTWARE AND ACCOMPANYING DOCUMENTATION, IF ANY, PROVIDED HEREUNDER IS
PROVIDED "AS IS". STRATOVAN HAS NO OBLIGATION TO PROVIDE MAINTENANCE,
SUPPORT, UPDATES, ENHANCEMENTS, OR MODIFICATIONS UNLESS DIRECTED BY THE
U.S. GOVERNMENT'S TRANSPORTATION SECURITY ADMINISTRATION (TSA).
-->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
    <center>Copyright (c) 2014 by Stratovan Corporation</br>
    Generated on Mon Sep 25 2023 00:04:59 for Stratovan DICOS Toolkit Class Interfaces and Architecture by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.18</center>
</small></address>
</body>
</html>
